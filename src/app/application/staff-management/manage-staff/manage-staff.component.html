<p-tabs [(value)]="activeTab">
    <p-tablist>
        <p-tab value="0">{{ isEditing ? 'Edit' : 'Add' }}</p-tab>
        <p-tab value="1">View</p-tab>
    </p-tablist>
    <p-tabpanels>
        <p-tabpanel value="0">
            <div class="card staff-form-card">
                <div class="form-hero">
                    <div>
                        <p class="eyebrow">People Operations</p>
                        <h3>{{ isEditing ? 'Update Staff Member' : 'Register a Staff Member' }}</h3>
                        <p>{{ isEditing ? 'Update personal, employment, and statutory details.' : 'Capture personal, employment, and statutory details in one pass.' }}</p>
                    </div>
                    <div class="form-meta">
                        <span class="label">Active staff</span>
                        <strong>{{ staffList.length }}</strong>
                    </div>
                </div>

                <form [formGroup]="staffForm" (ngSubmit)="onSubmit()" class="staff-form-grid">
                    <section class="form-section">
                        <header>
                            <h4>Personal Information</h4>
                            <span>Identity and contact</span>
                        </header>

                        <div class="form-row">
                            <div class="form-field">
                                <label for="fullName" class="required">Full Name</label>
                                <input pInputText id="fullName" type="text" formControlName="fullName" 
                                       [ngClass]="{'invalid-field': f['fullName'].touched && f['fullName'].invalid}" />
                                <small class="p-error"
                                    *ngIf="f['fullName'].touched && f['fullName'].errors?.['required']">
                                    Full Name is required.
                                </small>
                                <small class="p-error"
                                    *ngIf="f['fullName'].touched && f['fullName'].errors?.['minlength']">
                                    Full Name must be at least 3 characters.
                                </small>
                            </div>

                            <div class="form-field">
                                <label for="dob" class="required">Date of Birth</label>
                                <p-calendar id="dob" dateFormat="dd/mm/yy" [showIcon]="true"
                                    formControlName="dob" [ngClass]="{'invalid-field': f['dob'].touched && f['dob'].invalid}"></p-calendar>
                                <small class="p-error" *ngIf="f['dob'].touched && f['dob'].errors?.['required']">
                                    Date of Birth is required.
                                </small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-field">
                                <label for="gender" class="required">Gender</label>
                                <p-dropdown id="gender" [options]="genderOptions" placeholder="Select a Gender"
                                    formControlName="gender" [ngClass]="{'invalid-field': f['gender'].touched && f['gender'].invalid}"></p-dropdown>
                                <small class="p-error"
                                    *ngIf="f['gender'].touched && f['gender'].errors?.['required']">
                                    Gender is required.
                                </small>
                            </div>

                            <div class="form-field">
                                <label for="mobileNumber" class="required">Mobile Number</label>
                                <p-inputMask id="mobileNumber" mask="(+91) 99999-99999"
                                    formControlName="mobileNumber" [ngClass]="{'invalid-field': f['mobileNumber'].touched && f['mobileNumber'].invalid}"></p-inputMask>
                                <small class="p-error"
                                    *ngIf="f['mobileNumber'].touched && f['mobileNumber'].errors?.['required']">
                                    Mobile number is required.
                                </small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-field">
                                <label for="email" class="required">Personal Email</label>
                                <input pInputText id="email" type="email" formControlName="email" 
                                       [ngClass]="{'invalid-field': f['email'].touched && f['email'].invalid}" />
                                <small class="p-error" *ngIf="f['email'].touched && f['email'].errors?.['required']">
                                    Email is required.
                                </small>
                                <small class="p-error" *ngIf="f['email'].errors?.['email']">
                                    Please enter a valid email address.
                                </small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-field span-two">
                                <label for="currentAddress" class="required">Current Address</label>
                                <textarea id="currentAddress" pInputTextarea rows="3"
                                    formControlName="currentAddress" [ngClass]="{'invalid-field': f['currentAddress'].touched && f['currentAddress'].invalid}"></textarea>
                                <small class="p-error"
                                    *ngIf="f['currentAddress'].touched && f['currentAddress'].errors?.['required']">
                                    Address is required.
                                </small>
                            </div>
                        </div>
                    </section>

                    <section class="form-section">
                        <header>
                            <h4>Employment Details</h4>
                            <span>Role, department, and IDs</span>
                        </header>

                        <div class="form-row">
                            <div class="form-field">
                                <label for="employeeId" class="required">Employee ID</label>
                                <input pInputText id="employeeId" type="text" formControlName="employeeId" 
                                       [ngClass]="{'invalid-field': f['employeeId'].touched && f['employeeId'].invalid}" />
                                <small class="p-error"
                                    *ngIf="f['employeeId'].touched && f['employeeId'].errors?.['required']">
                                    Employee ID is required.
                                </small>
                            </div>

                            <div class="form-field">
                                <label for="doj" class="required">Date of Joining</label>
                                <p-calendar id="doj" dateFormat="dd/mm/yy" [showIcon]="true"
                                    formControlName="dateOfJoining" [ngClass]="{'invalid-field': f['dateOfJoining'].touched && f['dateOfJoining'].invalid}"></p-calendar>
                                <small class="p-error"
                                    *ngIf="f['dateOfJoining'].touched && f['dateOfJoining'].errors?.['required']">
                                    Date of Joining is required.
                                </small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-field">
                                <label for="jobTitle" class="required">Job Title / Designation</label>
                                <input pInputText id="jobTitle" type="text" formControlName="jobTitle" 
                                       [ngClass]="{'invalid-field': f['jobTitle'].touched && f['jobTitle'].invalid}" />
                                <small class="p-error"
                                    *ngIf="f['jobTitle'].touched && f['jobTitle'].errors?.['required']">
                                    Job Title is required.
                                </small>
                            </div>

                            <div class="form-field">
                                <label for="department" class="required">Department</label>
                                <p-dropdown id="department" [options]="departmentOptions"
                                    placeholder="Select a Department" formControlName="department" 
                                    [ngClass]="{'invalid-field': f['department'].touched && f['department'].invalid}"></p-dropdown>
                                <small class="p-error"
                                    *ngIf="f['department'].touched && f['department'].errors?.['required']">
                                    Department is required.
                                </small>
                            </div>
                        </div>
                    </section>

                    <section class="form-section">
                        <header>
                            <h4>Financial & Statutory Details</h4>
                            <span>Compliance identifiers</span>
                        </header>

                        <div class="form-row">
                            <div class="form-field">
                                <label for="panNumber" class="required">PAN Number</label>
                                <input pInputText id="panNumber" type="text" formControlName="panNumber"
                                    style="text-transform: uppercase;" [ngClass]="{'invalid-field': f['panNumber'].touched && f['panNumber'].invalid}" />
                                <small class="p-error"
                                    *ngIf="f['panNumber'].touched && f['panNumber'].errors?.['required']">
                                    PAN Number is required.
                                </small>
                                <small class="p-error" *ngIf="f['panNumber'].errors?.['pattern']">
                                    Invalid PAN format (e.g., ABCDE1234F).
                                </small>
                            </div>

                            <div class="form-field">
                                <label for="aadhaarNumber" class="required">Aadhaar Number</label>
                                <p-inputMask id="aadhaarNumber" mask="9999-9999-9999"
                                    formControlName="aadhaarNumber" [ngClass]="{'invalid-field': f['aadhaarNumber'].touched && f['aadhaarNumber'].invalid}"></p-inputMask>
                                <small class="p-error"
                                    *ngIf="f['aadhaarNumber'].touched && f['aadhaarNumber'].errors?.['required']">
                                    Aadhaar Number is required.
                                </small>
                            </div>
                        </div>
                    </section>

                    <div class="form-actions">
                        <ng-container *ngIf="!isEditing; else updateButtons">
                            <p-button label="Add Staff" icon="pi pi-plus" type="submit"
                                [disabled]="staffForm.invalid"></p-button>
                        </ng-container>
                        <ng-template #updateButtons>
                            <p-button label="Update Staff" icon="pi pi-save" type="button" (click)="onUpdateStaff()"
                                [disabled]="staffForm.invalid"></p-button>
                            <p-button label="Cancel" icon="pi pi-times" class="p-button-text p-button-plain"
                                type="button" (click)="resetEdit()"></p-button>
                        </ng-template>
                    </div>
                </form>
            </div>
        </p-tabpanel>
        <p-tabpanel value="1">
            <div class="card">
                <div class="flex justify-content-between align-items-center mb-3">
                    <h5 class="m-0">Staff Directory</h5>
                    <span class="p-input-icon-left">
                        <i class="pi pi-search"></i>
                        <input pInputText type="text" placeholder="Search staff..."
                            [value]="globalFilterValue" (input)="onGlobalFilter(dt, $event)" />
                    </span>
                </div>
                <p-table #dt [value]="staffList" dataKey="id" [globalFilterFields]="['employeeId','fullName','department','jobTitle','email','mobileNumber']"
                    styleClass="p-datatable-striped" [paginator]="true" [rows]="5" [rowsPerPageOptions]="[5,10,20]" sortMode="multiple">
                    <ng-template pTemplate="header">
                        <tr>
                            <th pSortableColumn="employeeId">
                                Employee ID
                                <p-sortIcon field="employeeId"></p-sortIcon>
                            </th>
                            <th pSortableColumn="fullName">
                                Full Name
                                <p-sortIcon field="fullName"></p-sortIcon>
                            </th>
                            <th pSortableColumn="department">
                                Department
                                <p-sortIcon field="department"></p-sortIcon>
                            </th>
                            <th pSortableColumn="jobTitle">
                                Job Title
                                <p-sortIcon field="jobTitle"></p-sortIcon>
                            </th>
                            <th pSortableColumn="email">
                                Email
                                <p-sortIcon field="email"></p-sortIcon>
                            </th>
                            <th pSortableColumn="mobileNumber">
                                Mobile
                                <p-sortIcon field="mobileNumber"></p-sortIcon>
                            </th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-staff>
                        <tr>
                            <td>{{ staff.employeeId }}</td>
                            <td>{{ staff.fullName }}</td>
                            <td>{{ staff.department }}</td>
                            <td>{{ staff.jobTitle }}</td>
                            <td>{{ staff.email }}</td>
                            <td>{{ staff.mobileNumber }}</td>
                            <td class="text-center flex justify-content-center gap-2">
                                <button pButton type="button" icon="pi pi-pencil"
                                    class="p-button-rounded p-button-text p-button-primary" pTooltip="Edit Staff"
                                    (click)="onEditStaff(staff)">
                                </button>
                                <button pButton type="button" icon="pi pi-trash"
                                    class="p-button-rounded p-button-text p-button-danger" pTooltip="Delete Staff"
                                    (click)="onDeleteStaff(staff)">
                                </button>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="7" class="text-center">No staff records found.</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </p-tabpanel>

    </p-tabpanels>
</p-tabs>